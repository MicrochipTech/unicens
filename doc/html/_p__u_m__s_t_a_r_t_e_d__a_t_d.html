<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>UNICENS: Audio Transportation Delay</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="style_html.css" rel="stylesheet" type="text/css" />
<link href="INICInterfaceSpecification.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div class="GlobalWrapper">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr>
  <td><a href="index.html"><img alt="Logo" src="logo.png"/></a></td>
  <td>
   <div id="projectname">UNICENS&#160;<span id="projectnumber">V2.3.0-4567</span></div>
   <div id="projectbrief">User Manual and API Reference</div>
    <div id="searchbox">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_p__u_m__s_t_a_r_t_e_d__a_t_d.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Audio Transportation Delay </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Introduction</h1>
<p>Due to <code>INIC</code> internal routing and network setup, audio data can have different delay times from source to sink for diverse routes. These delay between source and sink is called <code>ATD</code> (Audio Transportation Delay). There are application scenarios of audio data processing where it is essential to know the <code>ATD</code> value of the routes, for example Beam Forming or Noise Canceling. In such applications it is required that all simultaneously recorded samples from multiple microphones are processed together. Therefore the time shift between the microphones can be determined with the use of the ATD module.</p>
<p>The <code>ATD</code> calculation is implemented as an additional feature of the Route Management. It can be enabled for desired routes. The class CAtd calculates the audio transportation delay for the corresponding route and keeps the value ready for user requests. Also the user gets notified, if the <code>ATD</code> value changes due to a network event.</p>
<h1>Initialization</h1>
<p>The initialization of the ATD class is done by the Routing Management. Desired routes can be signed in for ATD calculation by setting the <code>atd_enabled</code> flag to <code>true</code> and the clock_config to the corresponding streaming port clock speed of the source endpoint.</p>
<div class="fragment"><div class="line"><span class="comment">/* Configuration structure of routes ATD settings. */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>Ucs_Rm_Atd_</div>
<div class="line">{<span class="comment"></span></div>
<div class="line"><span class="comment">    /*! \brief Flag to enable the ATD calculation for the corresponding route. */</span></div>
<div class="line">    uint8_t enabled;<span class="comment"></span></div>
<div class="line"><span class="comment">    /*! \brief Clock speed configured for the source streaming port. */</span></div>
<div class="line">    <a class="code" href="group___g___u_c_s___x_r_m___e_n_u_m_ga0e856884fa1c7908c59718da0f396484.html#ga0e856884fa1c7908c59718da0f396484" title="Clock speed configuration of the SCK signal.">Ucs_Stream_PortClockConfig_t</a> clk_config;</div>
<div class="line"></div>
<div class="line">} <a class="code" href="struct_ucs___rm___atd__t.html" title="Configuration structure to enable and setup the ATD module.">Ucs_Rm_Atd_t</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Configuration structure of a Route. */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>Ucs_Rm_Route_</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="struct_ucs___rm___end_point__t.html" title="Configuration structure of a Connection EndPoint.">Ucs_Rm_EndPoint_t</a> * source_endpoint_ptr;</div>
<div class="line">    <a class="code" href="struct_ucs___rm___end_point__t.html" title="Configuration structure of a Connection EndPoint.">Ucs_Rm_EndPoint_t</a> * sink_endpoint_ptr;</div>
<div class="line">    uint8_t active;</div>
<div class="line">    uint16_t route_id;</div>
<div class="line">    <a class="code" href="struct_ucs___rm___atd__t.html" title="Configuration structure to enable and setup the ATD module.">Ucs_Rm_Atd_t</a> atd; <span class="comment">/* ATD settings */</span></div>
<div class="line">    Ucs_Rm_RouteInt_t internal_infos;</div>
<div class="line"></div>
<div class="line">} <a class="code" href="struct_ucs___rm___route__t.html" title="Configuration structure of a Route.">Ucs_Rm_Route_t</a>;</div>
</div><!-- fragment --><p>This ATD configuration could look like the example below. The required values are set in the AtdSetup structure and included in the route structure.</p>
<div class="fragment"><div class="line"><a class="code" href="struct_ucs___rm___route__t.html" title="Configuration structure of a Route.">Ucs_Rm_Route_t</a> route = {</div>
<div class="line">        &amp;SourceEndpointForRoute,</div>
<div class="line">        &amp;SinkEndpointForRoute,</div>
<div class="line">        1,</div>
<div class="line">        0x0066,</div>
<div class="line">        {1, <a class="code" href="group___g___u_c_s___x_r_m___e_n_u_m_ga0e856884fa1c7908c59718da0f396484.html#gga0e856884fa1c7908c59718da0f396484a6ecefb4d6d534dfc6225644bf6cb9823" title="64 x Fs">UCS_STREAM_PORT_CLK_CFG_64FS</a>} <span class="comment">/* ATD enabled and clock configuration set */</span></div>
<div class="line">};</div>
</div><!-- fragment --><h1>Processing Narrative</h1>
<p>The ATD module acts as a subclass of the Routes Management. Direct interaction between the API and ATD class is not needed. However, the API gets notified if the ATD value has changed due to an MPR change event or new route build event. This notification is realized by a call of the App_OnRoutingResult() function. Through the given route info it can be distinguish whether it is an ATD update available, an ATD error occurred or an other routes event occurred. If an updated ATD value is available for a route, the user can get if by calling the Routing Management function <a class="el" href="group___g___u_c_s___r_o_u_t_i_n_g_gabd03043a7c42706c10b85ae44d15437d.html#gabd03043a7c42706c10b85ae44d15437d" title="This function retrieves the ATD value of the given route reference.">Ucs_Rm_GetAtdValue()</a>. <br/>
<br/>
 The following also illustrates the interaction between these objects within the "ATD calculation process" use case.</p>
<div class="image">
<img src="atd_seq_api.png" alt="atd_seq_api.png"/>
</div>
<h1><a class="anchor" id="Rm_Atd_Ex"></a>
Processing Example</h1>
<p>The code example below shows how the CAtd class is used from the API using the routing management. </p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> App_OnRoutingResult(<a class="code" href="struct_ucs___rm___route__t.html" title="Configuration structure of a Route.">Ucs_Rm_Route_t</a>* route_ptr, <a class="code" href="group___g___u_c_s___r_o_u_t_i_n_g___t_y_p_e_s_ga75ffbf28e4afc99a6abdbff0887baf9b.html#ga75ffbf28e4afc99a6abdbff0887baf9b" title="This enumerator specifies the possible route information.">Ucs_Rm_RouteInfos_t</a> route_infos, <span class="keywordtype">void</span> *user_ptr)</div>
<div class="line">{</div>
<div class="line">    uint16_t atd_value_ptr;</div>
<div class="line">    <a class="code" href="group___g___u_c_s___i_n_i_t___a_n_d___s_r_v___t_y_p_e_s_ga886138f5d13e84ffaa3df5769830e1cd.html#ga886138f5d13e84ffaa3df5769830e1cd" title="Standard return codes used for synchronous response.">Ucs_Return_t</a> ret = <a class="code" href="group___g___u_c_s___i_n_i_t___a_n_d___s_r_v___t_y_p_e_s_ga886138f5d13e84ffaa3df5769830e1cd.html#gga886138f5d13e84ffaa3df5769830e1cda7e6114552879861375322bf68dafe3a3" title="Functionality not available.">UCS_RET_ERR_NOT_AVAILABLE</a>;</div>
<div class="line">    APP_UNUSED(user_ptr);</div>
<div class="line"></div>
<div class="line">    (void)printf(<span class="stringliteral">&quot;\rRoute {%X} &quot;</span>, route_ptr-&gt;<a class="code" href="struct_ucs___rm___route__t_af45aa1590137605530f1757465709d39.html#af45aa1590137605530f1757465709d39" title="User-defined route identifier.">route_id</a>);</div>
<div class="line">    <span class="keywordflow">switch</span> (route_infos)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="group___g___u_c_s___r_o_u_t_i_n_g___t_y_p_e_s_ga75ffbf28e4afc99a6abdbff0887baf9b.html#gga75ffbf28e4afc99a6abdbff0887baf9badb63fb6363ebb3ae51d0bf8e3892138e" title="Specifies that a new ATD value is available.">UCS_RM_ROUTE_INFOS_ATD_UPDATE</a>:</div>
<div class="line">            (void)printf(<span class="stringliteral">&quot; ATD update available\r\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">switch</span> (<a class="code" href="group___g___u_c_s___r_o_u_t_i_n_g_gabd03043a7c42706c10b85ae44d15437d.html#gabd03043a7c42706c10b85ae44d15437d" title="This function retrieves the ATD value of the given route reference.">Ucs_Rm_GetAtdValue</a>(running_inst_ptr, route_ptr, &amp;atd_value_ptr))</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">case</span> <a class="code" href="group___g___u_c_s___i_n_i_t___a_n_d___s_r_v___t_y_p_e_s_ga886138f5d13e84ffaa3df5769830e1cd.html#gga886138f5d13e84ffaa3df5769830e1cda3fb51656e17ee4802f23706f35e349bc" title="Operation successfully completed.">UCS_RET_SUCCESS</a>:</div>
<div class="line">                    <span class="comment">/* Pointer &quot;atd_value_ptr&quot; to ATD value in micro seconds */</span></div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <a class="code" href="group___g___u_c_s___i_n_i_t___a_n_d___s_r_v___t_y_p_e_s_ga886138f5d13e84ffaa3df5769830e1cd.html#gga886138f5d13e84ffaa3df5769830e1cda7e6114552879861375322bf68dafe3a3" title="Functionality not available.">UCS_RET_ERR_NOT_AVAILABLE</a>:</div>
<div class="line">                    <span class="comment">/* ATD value is not available */</span></div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <a class="code" href="group___g___u_c_s___i_n_i_t___a_n_d___s_r_v___t_y_p_e_s_ga886138f5d13e84ffaa3df5769830e1cd.html#gga886138f5d13e84ffaa3df5769830e1cdab98b74c51324859f3138fed96afd1573" title="At least one parameter exceeds its admissible range.">UCS_RET_ERR_PARAM</a>:</div>
<div class="line">                    <span class="comment">/* ATD value is not up to date */</span></div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                    <span class="comment">/* ATD value is not available */</span></div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">              }</div>
<div class="line">       <span class="keywordflow">break</span>;</div>
<div class="line">       <span class="keywordflow">case</span> <a class="code" href="group___g___u_c_s___r_o_u_t_i_n_g___t_y_p_e_s_ga75ffbf28e4afc99a6abdbff0887baf9b.html#gga75ffbf28e4afc99a6abdbff0887baf9ba1026c9d7cd077ef0938ca6984442f514" title="Specifies that a ATD calculation was stopped due to an error.">UCS_RM_ROUTE_INFOS_ATD_ERROR</a>:</div>
<div class="line">           (void)printf(<span class="stringliteral">&quot; ATD error occurred: \r\n&quot;</span>);</div>
<div class="line">           <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1>Limitations</h1>
<ul>
<li>The ATD class can't perform when the network is in Fallback mode.</li>
<li>The ATD class does not support the use case when source node is also the sink node.</li>
<li>The ATD calculation can be processed for synchronous streaming connections only. MediaLB is not supported. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">&copy; 2019 Microchip Technology Inc. All rights reserved. <a href="http://www.microchip.com" target="_blank">www.microchip.com</a></li>
  </ul>
</div>
</body>
<!--
Generated on Wed Jun 19 2019 16:18:16 for UNICENS by
Doxygen 1.8.2
-->
<script language="javascript">
<!--
$('#MSearchResults').wrap('<div style="position: absolute; margin-left: 444px;"></div>');
-->
</script>
</html>
